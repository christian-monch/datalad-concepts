id: https://concepts.datalad.org/s/distribution/unreleased
name: distribution-schema
version: UNRELEASED
status: bibo:status/draft
title: Schema for a generic data distribution record
description: |
  This schema is centered on the description of concrete data distributions
  using a single root class that uniformly applies to different kinds of
  distributions, like an individual file, an archive of files, or a directory
  of files.

  There is [dedicated documentation](about.md) with general information on the
  purpose and basic principles of this schema.

  Key goal is the use of global identifiers for most entities.

  A standard record should mostly be a simple key value mapping, where the value
  part is a URI or CURIE.

  Few slots (provenance related) allow for the inline declaration of (typed)
  objects, declaring an identifier that can be used to link to such an object
  in other metadata records.
comments:
  - ALL CONTENT HERE IS UNRELEASED AND MAY CHANGE ANY TIME

license: MIT

prefixes:
  ADMS: http://www.w3.org/ns/adms#
  bibo: http://purl.org/ontology/bibo/
  CiTO: http://purl.org/spar/cito/
  DCAT: http://www.w3.org/ns/dcat#
  dcterms: http://purl.org/dc/terms/
  DCTYPES: http://purl.org/dc/dcmitype/
  dlco: https://concepts.datalad.org/
  dldist: https://concepts.datalad.org/s/distribution/unreleased/
  dpv: https://w3id.org/dpv#
  foaf: http://xmlns.com/foaf/0.1/
  linkml: https://w3id.org/linkml/
  obo: http://purl.obolibrary.org/obo/
  owl: http://www.w3.org/2002/07/owl#
  pav: http://purl.org/pav/
  prov: http://www.w3.org/ns/prov#
  RDF: http://www.w3.org/1999/02/22-rdf-syntax-ns#
  RDFS: http://www.w3.org/2000/01/rdf-schema#
  schema: http://schema.org/
  skos: http://www.w3.org/2004/02/skos/core#
  sio: http://semanticscience.org/resource/
  spdx: http://spdx.org/rdf/terms#
  licenses: http://spdx.org/licenses/
  marcrel: http://id.loc.gov/vocabulary/relators/
  # example convenience namespaces that make it possible to not think about
  # a dedicated distribution/dataset/dataset-version-unqiue namespace.
  # the prefix can be materialized ala
  # linkml-convert -s ... -t rdf -P exthisds=http://example.com/ --infer ...
  #
  # the three following prefixes are examples. a use case specific derived
  # schema needs to define its own, differently named and defined namespaces.
  #
  # a custom umbrella namespace (e.g. for a project, a consortium, a domain)
  # to keep vocabulary and entities local to this scope
  exthisns: https://example.org/ns/
  # a custom namespace that is unique to a particular dataset, but common
  # across all versions of it. It could be nested inside the `thisns` namespace
  exthisds: https://example.org/ns/dataset/
  # a custom namespace that is unique to a particular version of a single
  # dataset. It could be nested inside the `thisds` namespace
  exthisdsver: https://example.org/ns/datasetversion/

default_prefix: dldist

emit_prefixes:
  - CiTO
  - DCAT
  - dldist
  - licenses
  - marcrel
  - obo
  - prov

imports:
  - ../prov/unreleased

types:
  EmailAddress:
    uri: dldist:EmailAddress
    base: str
    description: RFC 5322 compliant email address
    pattern: '(?:[a-z0-9!#$%&''*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&''*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])'
    notes:
      - The validation regex is taken from https://stackoverflow.com/a/201378
      - The regex is single-quoted for YAML encoding, hence all inner "'" have been doubled

  HexBinary:
    uri: xsd:hexBinary
    base: str
    pattern: "^[a-fA-F0-9]+$"
    description: >-
      hex-encoded binary data.

  NonNegativeInteger:
    uri: xsd:nonNegativeInteger
    base: int
    description: An integer
    notes: >-
      Integer with minimum (inclusive) value of zero, i.e. the standard
      mathematical concept of the non-negative integers.
    broad_mappings:
      - schema:Integer


slots:
  access_id:
    slot_uri: dldist:access_id
    description: >-
      An identifier with which a resource distribution can be requested from a
      `DataService`.
    broad_mappings:
      - dcterms:identifier
    range: string
    related_mappings:
      - DCAT:servesDataset

  address:
    slot_uri: dldist:address
    description:
      Physical address of the subject, such as a postal address, a bibliographic
      locator, or a coordinate of some kind.
    range: string
    close_mappings:
      - schema:address

  affiliation:
    slot_uri: dldist:affiliation
    description: >-
      An organization that an agent is affiliated with.
    range: Organization
    exact_mappings:
      - schema:affiliation

  algorithm:
    description: >-
      The algorithm or rules to follow to compute a score, an effective method
      expressed as a finite list of well-defined instructions for calculating
      a function.
    range: uriorcurie
    exact_mappings:
      - schema:algorithm
      - obo:IAO_0000064

  byte_size:
    slot_uri: dldist:byte_size
    description: >-
      The size of a distribution in bytes.
    range: NonNegativeInteger
    exact_mappings:
      - DCAT:byteSize

  checksum:
    slot_uri: dldist:checksum
    description: >-
      The checksum property provides a mechanism that can be used to verify
      that the contents of a file or package have not changed.
    range: Checksum
    exact_mappings:
      - spdx:checksum

  conforms_to:
    slot_uri: dlprov:conforms_to
    description: >-
      An established standard to which the subject conforms.
    range: uriorcurie
    comments:
      - This property SHOULD be used to indicate the model, schema, ontology, view or profile that this representation of a dataset conforms to. This is (generally) a complementary concern to the media-type or format.
    exact_mappings:
      - dcterms:conformsTo

  date_modified:
    slot_uri: dldist:date_modified
    description: >-
      Date on which the resource was (last) changed, updated or modified.
    range: W3CISO8601
    exact_mappings:
      - dcterms:modified
    notes:
      - successful validation with `datetime` as a range and linkml-jsonschema-validate` depends on a patched linkml, see https://github.com/linkml/linkml/issues/1806
      - a related problem also exists for `linkml-validate`, we cannot have a more specific range right now

  date_published:
    slot_uri: dldist:date_published
    description: >-
      Date on which the resource was (last) changed, updated or modified.
    range: W3CISO8601
    exact_mappings:
      - schema:datePublished
    notes:
      - successful validation with `datetime` as a range and linkml-jsonschema-validate` depends on a patched linkml, see https://github.com/linkml/linkml/issues/1806
      - a related problem also exists for `linkml-validate`, we cannot have a more specific range right now

  digest:
    slot_uri: dldist:digest
    description: >-
      Lower case hexadecimal encoded checksum digest value produced using a
      specific algorithm.
    range: HexBinary
    exact_mappings:
      - spdx:checksumValue

  distribution:
    slot_uri: dldist:distribution
    description: >-
      An available distribution of a resource.
    range: Distribution
    close_mappings:
      - DCAT:distribution
    comments:
      - Unlike `DCAT:distribution`, this property does not restrict its domain to
        a dataset.

  download_url:
    slot_uri: dldist:download_url
    description: >-
      URL of downloadable resourcefile in a given format.
    range: uri
    exact_mappings:
      - DCAT:downloadURL

  email:
    slot_uri: dldist:email
    description: Email address associated with an entity.
    exact_mappings:
      - schema:email
      - obo:IAO_0000429
    range: EmailAddress

  format:
    slot_uri: dldist:format
    description: >-
      The file format of a distribution.
    domain: Distribution
    range: uriorcurie
    exact_mappings:
      - dcterms:format
    notes:
      - When type of the distribution is defined by IANA, `media_type` should be used.

  has_part:
    slot_uri: dldist:has_part
    description: >-
      A related resource that is included either physically
      or logically in the described resource.
    exact_mappings:
      - dcterms:hasPart

  is_distribution_of:
    slot_uri: dldist:is_distribution_of
    description: >-
      Inverse property of `DCAT:distribution`.
    domain: Distribution
    range: Resource
    inverse: distribution

  is_part_of:
    slot_uri: dldist:is_part_of
    description: >-
      A related resource that is included either physically
      or logically in the described resource.
    exact_mappings:
      - dcterms:isPartOf

  is_version_of:
    slot_uri: dldist:is_version_of
    description: >-
      A related resource of which the described resource is a version.
    range: uriorcurie
    exact_mappings:
      - DCAT:isVersionOf

  keyword:
    slot_uri: dldist:keyword
    description: >-
      One or more keywords or tags describing the resource.
    range: string
    multivalued: true
    exact_mappings:
      - dcat:keyword
      - schema:keywords

  landing_page:
    slot_uri: dldist:landing_page
    description: >-
      A Web page that can be navigated to in a Web browser to gain access
      to a resource, its distributions and/or additional information.
    range: uri
    exact_mappings:
      - DCAT:landingPage
      - foaf:page
    comments:
      - If the distribution(s) are accessible only through a landing page (i.e., direct download URLs are not known), then the landing page link SHOULD be duplicated as `dldist:access_url` on a distribution.
    see_also:
      - https://www.w3.org/TR/vocab-dcat-3/#example-landing-page

  license:
    slot_uri: dldist:license
    description: A legal document under which the resource is made available.
    range: LicenseDocument
    exact_mappings:
      - dcterms:license
      - DCAT:license

  license_text:
    slot_uri: dldist:license_text
    description: >-
      A copy of the actual text of a license reference, file or snippet that is
      associated with a License Identifier to aid in future analysis.
    range: string
    exact_mappings:
      - spdx:extractedText

  media_type:
    slot_uri: dldist:media_type
    is_a: format
    description: >-
      The media type of a distribution as defined by IANA
    domain: Distribution
    range: string
    examples:
      - value: text/csv
    see_also:
      - https://www.iana.org/assignments/media-types
    exact_mappings:
      - DCAT:mediaType

  qualified_access:
    slot_uri: dlco:qualified_access
    description: >-
      Link to a description of a `access_service` relationship with
      `DCAT:DataService`.
    broad_mappings:
      - DCAT:qualifiedRelation
    range: QualifiedAccess

  qualified_part:
    slot_uri: dldist:qualified_part
    description: >-
      Qualified a `hasPart` relationship with another entity.
    broad_mappings:
      - DCAT:qualifiedRelation

  version:
    slot_uri: dldist:version
    description: >-
      Version indicator (name or identifier) of a resource.
    range: string
    exact_mappings:
      - DCAT:version
      - pav:version


classes:
  #
  # agents
  #
  Person:
    class_uri: dldist:Person
    is_a: Agent
    description: >-
      Person agents are people.
    slots:
      - address
      - affiliation
      - email
    slot_usage:
      affiliation:
        multivalued: true
    exact_mappings:
      - foaf:Person
      - prov:Person

  Organization:
    class_uri: dldist:Organization
    is_a: Agent
    description: >-
      A social or legal instititution such as a company, a society,
      or a university.
    slots:
      - address
    exact_mappings:
      - foaf:Organization
      - prov:Organization

  #
  # entities
  #
  Distribution:
    class_uri: dldist:Distribution
    is_a: Entity
    description: >-
      A specific representation of data, which may come in the form of
      a single file, or an archive or directory of many files, may be
      standalone or part of a dataset.
    slots:
      - byte_size
      - checksum
      - conforms_to
      - date_modified
      - date_published
      # TODO multivalued?
      - download_url
      - format
      - has_part
      - is_distribution_of
      - license
      - media_type
      - qualified_access
      - qualified_part
    slot_usage:
      checksum:
        multivalued: true
        inlined: true
        inlined_as_list: true
      has_part:
        multivalued: true
        inlined: true
        inlined_as_list: true
        range: Distribution
      qualified_access:
        multivalued: true
        inlined: true
        inlined_as_list: true
        range: QualifiedAccess
      qualified_part:
        multivalued: true
        inlined: true
        inlined_as_list: true
        range: DistributionPart
    exact_mappings:
      - DCAT:Distribution

  Resource:
    class_uri: dldist:Resource
    is_a: Entity
    description: >-
      Resource published or curated by a single agent.
    notes:
      - Try to make having specific subtypes of this class unnecessary
    slots:
      - date_modified
      - date_published
      - is_part_of
      - is_version_of
      - keyword
      - landing_page
      - version
    slot_usage:
      is_part_of:
        range: Resource
      is_version_of:
        range: Resource
    exact_mappings:
      - DCAT:Resource

  LicenseDocument:
    class_uri: dldist:LicenseDocument
    is_a: Entity
    description: >-
      A legal document giving official permission to do something with a resource.
    slots:
      - license_text
    exact_mappings:
      - dcterms:LicenseDocument
      - spdx:License
    todos:
      - spdx vocab has a needed pieces to express a any custom license

  #
  # basic relations
  #
  DistributionPart:
    class_uri: dldist:DistributionPart
    description: >-
      An association class for attaching additional information to a
      hasPart relationship.
    broad_mappings:
      - DCAT:Relationship
    slots:
      - name
      - entity
    slot_usage:
      name:
        description: >-
          The name of the part within the containing entity.
    comments:
      - This class is a key element of the data model. It enables referencing
        a particular resource (e.g., a file's content, or versioned directory
        tree in multiple contexts, such as different versions of a dataset).

  #
  # utilities
  #
  Checksum:
    class_uri: dldist:Checksum
    description: >-
      A Checksum is a value that allows to check the integrity of the contents
      of a file. Even small changes to the content of the file will change its
      checksum. This class allows the results of a variety of checksum and
      cryptographic message digest algorithms to be represented.
    slots:
      - algorithm
      - digest
    slot_usage:
      algorithm:
        slot_uri: spdx:algorithm
        description: >-
          Identifies the algorithm used to produce the subject `Checksum`.
    exact_mappings:
      - spdx:Checksum

  #
  # data access
  #
  DataService:
    class_uri: dldist:DataService
    is_a: Resource
    description: >-
      A collection of operations that provides access to one or more
      distributions or data processing functions.
    exact_mappings:
      - DCAT:DataService
    broad_mappings:
      - DCAT:Resource
      - DCTYPES:Service
    todos:
      - Enable indication what kind of credentials are required for access, and where to obtain them.

  QualifiedAccess:
    class_uri: dldist:QualifiedAccess
    is_a: EntityInfluence
    description: >-
      An association class for attaching additional information to an
      `access_service` relationship between a `DCAT:Distribution` and
      a `DCAT:DataService`.
    related_mappings:
      - DCAT:access_service
    slots:
      - access_id
    slot_usage:
      #had_role:
        # in this context we can auto-fill the role
        # (but had_role is multivalued, and linkml does not support
        # defaults for multivalued slots)
        # ifabsent: string(DCAT:DataService)
      entity:
        # must duplicate multivalued property, although unchanged
        # otherwise linkml will use wrong dtype for identifier
        # (array of CURIE)
        multivalued: true
        range: DataService
